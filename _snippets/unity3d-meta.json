{
  "$$data_type": "org-document",
  "properties": {
    "title": ["Fix Unity3d \"Missing Script\" issues"],
    "filetags": [],
    "author": ["Michael McFarland"],
    "creator": "Emacs 28.0.60 (Org mode 9.6)",
    "date": ["2015-06-16"],
    "description": [],
    "email": "michaelmcfarland@michaels-air.lan",
    "language": "en"
  },
  "contents": [
    {
      "$$data_type": "org-node",
      "type": "section",
      "ref": "org191f088",
      "properties": {
        "robust-begin": 1,
        "robust-end": 419,
        "post-blank": 1,
        "post-affiliated": 1,
        "mode": "first-section",
        "granularity": null
      },
      "contents": [
        {
          "$$data_type": "org-node",
          "type": "keyword",
          "ref": "org574e49e",
          "properties": {
            "key": "STARTUP",
            "value": "showall indent",
            "post-blank": 0,
            "post-affiliated": 1,
            "mode": "top-comment",
            "granularity": null
          },
          "contents": []
        },
        {
          "$$data_type": "org-node",
          "type": "keyword",
          "ref": "org1b4a8df",
          "properties": {
            "key": "OPTIONS",
            "value": "num:nil",
            "post-blank": 0,
            "post-affiliated": 27,
            "mode": null,
            "granularity": null
          },
          "contents": []
        },
        {
          "$$data_type": "org-node",
          "type": "keyword",
          "ref": "orgd0de080",
          "properties": {
            "key": "TITLE",
            "value": "Fix Unity3d \"Missing Script\" issues",
            "post-blank": 0,
            "post-affiliated": 46,
            "mode": null,
            "granularity": null
          },
          "contents": []
        },
        {
          "$$data_type": "org-node",
          "type": "keyword",
          "ref": "org8192a5c",
          "properties": {
            "key": "DATE",
            "value": "2015-06-16",
            "post-blank": 0,
            "post-affiliated": 91,
            "mode": null,
            "granularity": null
          },
          "contents": []
        },
        {
          "$$data_type": "org-node",
          "type": "keyword",
          "ref": "org536ea29",
          "properties": {
            "key": "CATEGORY",
            "value": "code",
            "post-blank": 1,
            "post-affiliated": 110,
            "mode": null,
            "granularity": null
          },
          "contents": []
        },
        {
          "$$data_type": "org-node",
          "type": "paragraph",
          "ref": "orgdd5bb2c",
          "properties": {
            "post-blank": 0,
            "post-affiliated": 128,
            "mode": null,
            "granularity": null
          },
          "contents": [
            "If you've ever worked on a team using Unity3d, somebody has forgotten to commit a .meta file.\nIt's fairly easy to do, and pretty hard to notice you're doing it (things still work for you, just not others who pull your work in). I've been bitten by this mistake plenty, from myself and others.\n"
          ]
        }
      ]
    },
    {
      "$$data_type": "org-node",
      "type": "headline",
      "ref": "orgc84e134",
      "drawer": {},
      "properties": {
        "tags-all": [],
        "raw-value": "Why does this happen",
        "pre-blank": 0,
        "robust-begin": 447,
        "robust-end": 714,
        "level": 1,
        "priority": null,
        "tags": [],
        "todo-keyword": null,
        "todo-type": null,
        "post-blank": 1,
        "footnote-section-p": false,
        "archivedp": false,
        "commentedp": false,
        "post-affiliated": 422,
        "title": ["Why does this happen"],
        "mode": null,
        "granularity": null
      },
      "contents": [
        {
          "$$data_type": "org-node",
          "type": "section",
          "ref": "orge547c85",
          "properties": {
            "robust-begin": 445,
            "robust-end": 714,
            "post-blank": 1,
            "post-affiliated": 445,
            "mode": "section",
            "granularity": null
          },
          "contents": [
            {
              "$$data_type": "org-node",
              "type": "paragraph",
              "ref": "org685ce60",
              "properties": {
                "post-blank": 0,
                "post-affiliated": 445,
                "mode": "planning",
                "granularity": null
              },
              "contents": [
                "The .meta file holds GUID for the given asset, which is how the editor associates assets for serialized data (your prefabs and scenes).\nWhen you're serialized data references the wrong id, then you get missing references that show up like \"Missing Script\" in the editor.\n"
              ]
            }
          ]
        }
      ]
    },
    {
      "$$data_type": "org-node",
      "type": "headline",
      "ref": "orga06a6d7",
      "drawer": {},
      "properties": {
        "tags-all": [],
        "raw-value": "The solution",
        "pre-blank": 0,
        "robust-begin": 734,
        "robust-end": 3811,
        "level": 1,
        "priority": null,
        "tags": [],
        "todo-keyword": null,
        "todo-type": null,
        "post-blank": 1,
        "footnote-section-p": false,
        "archivedp": false,
        "commentedp": false,
        "post-affiliated": 717,
        "title": ["The solution"],
        "mode": null,
        "granularity": null,
        "cached": true,
        "org-element--cache-sync-key": [14]
      },
      "contents": [
        {
          "$$data_type": "org-node",
          "type": "section",
          "ref": "org9759f1c",
          "properties": {
            "robust-begin": 732,
            "robust-end": 3811,
            "post-blank": 1,
            "post-affiliated": 732,
            "mode": "section",
            "granularity": null
          },
          "contents": [
            {
              "$$data_type": "org-node",
              "type": "paragraph",
              "ref": "org9039ad3",
              "properties": {
                "post-blank": 1,
                "post-affiliated": 732,
                "mode": "planning",
                "granularity": null
              },
              "contents": [
                "Don't let people commit and push assets without metas.\n"
              ]
            },
            {
              "$$data_type": "org-node",
              "type": "paragraph",
              "ref": "orgda683b8",
              "properties": {
                "post-blank": 1,
                "post-affiliated": 788,
                "mode": null,
                "granularity": null
              },
              "contents": [
                "Most version control systems have hooks that you can run your own scripts in,\nMercurials no different.\n"
              ]
            },
            {
              "$$data_type": "org-node",
              "type": "paragraph",
              "ref": "orgaf7a2aa",
              "properties": {
                "post-blank": 1,
                "post-affiliated": 892,
                "mode": null,
                "granularity": null
              },
              "contents": [
                "You can make a pre-commit hook that will look at all your assets\nand make sure none are missing a meta.\n"
              ]
            },
            {
              "$$data_type": "org-node",
              "type": "paragraph",
              "ref": "org30d7d80",
              "properties": {
                "post-blank": 1,
                "post-affiliated": 997,
                "mode": null,
                "granularity": null
              },
              "contents": [
                "I've made one below. It's worked fine for windows and mac machines,\nand some version of it has been in every unity project I've done since.\n"
              ]
            },
            {
              "$$data_type": "org-node",
              "type": "src-block",
              "ref": "orga4671e8",
              "properties": {
                "language": "python",
                "switches": null,
                "parameters": null,
                "number-lines": null,
                "preserve-indent": false,
                "retain-labels": true,
                "use-labels": true,
                "label-fmt": null,
                "value": "  import os\n  import mercurial.commands\n\n  class HG:\n    def __init__(self,ui,repo):\n      self.ui = ui\n      self.repo = repo\n      self.files = self.getAddedFiles()\n\n    def existsInRepo(self, filename):\n      self.ui.pushbuffer()\n      mercurial.commands.locate(self.ui,self.repo,include=[filename])\n      files = self.ui.popbuffer().split(\"\\n\")\n\n      for repoFile in files:\n        if(pathsEqual(filename,repoFile)):\n          return True\n\n      return False\n\n    def getAddedFiles(self):\n      self.ui.pushbuffer()\n      mercurial.commands.status(self.ui,self.repo,no_status=True, added = True)\n      files = self.ui.popbuffer().split(\"\\n\")\n      return files\n\n    def filesExistInDir(self,dirname):\n      self.ui.pushbuffer()\n      mercurial.commands.locate(self.ui,self.repo,include=[dirname])\n      files = self.ui.popbuffer().split(\"\\n\")\n      files = filter(lambda x:x != \"\", files)\n      return len(files) > 0\n\n    def show(self, message):\n      self.ui.status(message + \"\\n\")\n\n  def precommit(ui,repo, **kwargs):\n    hg = HG(ui,repo)\n    clean = checkFiles(hg)\n    return not clean;\n\n  def pathsEqual(a,b):\n    return os.path.normcase(a) == os.path.normcase(b)\n\n\n  def checkFiles(hg):\n\n    path = os.path.normcase(\"UnityProject/Assets/\")\n\n    result = True\n    files = hg.files\n    for singleFile in files:\n      if singleFile == '':\n        continue\n\n      if not os.path.normcase(singleFile).startswith(path):\n        continue\n\n      isMetaFile = singleFile.endswith(\".meta\")\n\n      filename = singleFile if not isMetaFile else singleFile.replace(\".meta\", \"\")\n      metaFile = singleFile if isMetaFile else singleFile + \".meta\"\n\n      isFolder = os.path.isdir(os.path.normcase(filename))\n\n      if isMetaFile:\n        if isFolder:\n          if not hg.filesExistInDir(filename):\n            hg.show(\"Commiting a meta file'\" + metaFile +\n              \"' for a directory which contains no files.\" )\n            return False\n        else:\n          if not hg.existsInRepo(filename):\n            hg.show(\"Commiting a meta file'\" + metaFile +\n              \"' without adding associated file '\" + filename + \"'.\")\n            return False\n\n      else:\n        if not hg.existsInRepo(metaFile):\n          hg.show(\"Committing a file '\" + filename +\n            \"' without adding associated meta file '\" + metaFile + \"'.\")\n          return False\n\n\n    return result\n",
                "post-blank": 1,
                "post-affiliated": 1138,
                "mode": null,
                "granularity": null
              },
              "contents": []
            },
            {
              "$$data_type": "org-node",
              "type": "paragraph",
              "ref": "org40f639c",
              "properties": {
                "post-blank": 0,
                "post-affiliated": 3540,
                "mode": null,
                "granularity": null
              },
              "contents": [
                "This ",
                {
                  "$$data_type": "org-node",
                  "type": "bold",
                  "ref": "org320a8b1",
                  "properties": {
                    "post-blank": 0
                  },
                  "contents": ["doesn't handle .meta files for directories"]
                },
                ". I couldn't think of an elegant way\nTo locate directories from the hg API. Mercurial has no concept of them, files are just at paths.\nThis hasn't been a problem and, AFAIK, directories aren't referenced in serialized data.\n"
              ]
            }
          ]
        }
      ]
    },
    {
      "$$data_type": "org-node",
      "type": "headline",
      "ref": "org99ae6e1",
      "drawer": {},
      "properties": {
        "tags-all": [],
        "raw-value": "Usage",
        "pre-blank": 0,
        "robust-begin": 3824,
        "robust-end": 4720,
        "level": 1,
        "priority": null,
        "tags": [],
        "todo-keyword": null,
        "todo-type": null,
        "post-blank": 0,
        "footnote-section-p": false,
        "archivedp": false,
        "commentedp": false,
        "post-affiliated": 3814,
        "title": ["Usage"],
        "mode": null,
        "granularity": null,
        "cached": true,
        "org-element--cache-sync-key": [24]
      },
      "contents": [
        {
          "$$data_type": "org-node",
          "type": "headline",
          "ref": "org96f93ff",
          "drawer": {},
          "properties": {
            "tags-all": [],
            "raw-value": "Configure your asset folder path",
            "pre-blank": 1,
            "robust-begin": 3861,
            "robust-end": 4152,
            "level": 2,
            "priority": null,
            "tags": [],
            "todo-keyword": null,
            "todo-type": null,
            "post-blank": 1,
            "footnote-section-p": false,
            "archivedp": false,
            "commentedp": false,
            "post-affiliated": 3822,
            "title": ["Configure your asset folder path"],
            "mode": "section",
            "granularity": null
          },
          "contents": [
            {
              "$$data_type": "org-node",
              "type": "section",
              "ref": "orgf3aa136",
              "properties": {
                "robust-begin": 3859,
                "robust-end": 4152,
                "post-blank": 1,
                "post-affiliated": 3859,
                "mode": "section",
                "granularity": null
              },
              "contents": [
                {
                  "$$data_type": "org-node",
                  "type": "paragraph",
                  "ref": "orgb7f8372",
                  "properties": {
                    "post-blank": 0,
                    "post-affiliated": 3859,
                    "mode": "planning",
                    "granularity": null
                  },
                  "contents": [
                    "in ",
                    {
                      "$$data_type": "org-node",
                      "type": "verbatim",
                      "ref": "org83da387",
                      "properties": {
                        "post-blank": 1,
                        "value": "checkFiles"
                      },
                      "contents": []
                    },
                    "alter the ",
                    {
                      "$$data_type": "org-node",
                      "type": "verbatim",
                      "ref": "orga8f1323",
                      "properties": {
                        "post-blank": 1,
                        "value": "path"
                      },
                      "contents": []
                    },
                    "variable so that it points to your assets directory.\nThe current value reflects my projects, which generally have the unity project folder start at the path ",
                    {
                      "$$data_type": "org-node",
                      "type": "verbatim",
                      "ref": "org42c47dc",
                      "properties": {
                        "post-blank": 0,
                        "value": "UnityProject"
                      },
                      "contents": []
                    },
                    ".\nThe script only checks the files under that path, and it's relative to your repo's root.\n"
                  ]
                }
              ]
            }
          ]
        },
        {
          "$$data_type": "org-node",
          "type": "headline",
          "ref": "orga7628ef",
          "drawer": {},
          "properties": {
            "tags-all": [],
            "raw-value": "Add the hook",
            "pre-blank": 0,
            "robust-begin": 4173,
            "robust-end": 4720,
            "level": 2,
            "priority": null,
            "tags": [],
            "todo-keyword": null,
            "todo-type": null,
            "post-blank": 0,
            "footnote-section-p": false,
            "archivedp": false,
            "commentedp": false,
            "post-affiliated": 4155,
            "title": ["Add the hook"],
            "mode": null,
            "granularity": null,
            "cached": true,
            "org-element--cache-sync-key": [24]
          },
          "contents": [
            {
              "$$data_type": "org-node",
              "type": "section",
              "ref": "org0857e42",
              "properties": {
                "robust-begin": 4171,
                "robust-end": 4720,
                "post-blank": 0,
                "post-affiliated": 4171,
                "mode": "section",
                "granularity": null
              },
              "contents": [
                {
                  "$$data_type": "org-node",
                  "type": "paragraph",
                  "ref": "orgcb50976",
                  "properties": {
                    "post-blank": 1,
                    "post-affiliated": 4171,
                    "mode": "planning",
                    "granularity": null
                  },
                  "contents": [
                    "Mercurial needs you to ",
                    {
                      "$$data_type": "org-node",
                      "type": "link",
                      "ref": "org1106383",
                      "properties": {
                        "type": "https",
                        "path": "//www.mercurial-scm.org/wiki/Hook",
                        "format": "bracket",
                        "raw-link": "https://www.mercurial-scm.org/wiki/Hook",
                        "application": null,
                        "search-option": null,
                        "post-blank": 1,
                        "is-internal": false,
                        "target-ref": null,
                        "is-inline-image": false
                      },
                      "contents": ["register the hook"]
                    },
                    "in your hg config.\nEveryone on the team should register and use this pre-commit hook in order for it to be effective.\nI keep them in hooks directory for the project for that reason.\n"
                  ]
                },
                {
                  "$$data_type": "org-node",
                  "type": "paragraph",
                  "ref": "org4cac133",
                  "properties": {
                    "post-blank": 1,
                    "post-affiliated": 4440,
                    "mode": null,
                    "granularity": null
                  },
                  "contents": [
                    "For example, Lets say you saved the above script to a file in your repo at ",
                    {
                      "$$data_type": "org-node",
                      "type": "verbatim",
                      "ref": "orgc634117",
                      "properties": {
                        "post-blank": 0,
                        "value": "hooks/checkMetas.py"
                      },
                      "contents": []
                    },
                    ".\n"
                  ]
                },
                {
                  "$$data_type": "org-node",
                  "type": "paragraph",
                  "ref": "org978dfef",
                  "properties": {
                    "post-blank": 1,
                    "post-affiliated": 4539,
                    "mode": null,
                    "granularity": null
                  },
                  "contents": [
                    "Then you would add these lines to your ",
                    {
                      "$$data_type": "org-node",
                      "type": "verbatim",
                      "ref": "orgdf79e82",
                      "properties": {
                        "post-blank": 1,
                        "value": ".hg/hgrc"
                      },
                      "contents": []
                    },
                    "file.\n"
                  ]
                },
                {
                  "$$data_type": "org-node",
                  "type": "src-block",
                  "ref": "org594f64a",
                  "properties": {
                    "language": "python",
                    "switches": null,
                    "parameters": null,
                    "number-lines": null,
                    "preserve-indent": false,
                    "retain-labels": true,
                    "use-labels": true,
                    "label-fmt": null,
                    "value": "    [hooks]\n    precommit.checkMetas = python:/pathToUnityRepo/hooks/checkMetas.py:precommit\n",
                    "post-blank": 0,
                    "post-affiliated": 4596,
                    "mode": null,
                    "granularity": null
                  },
                  "contents": []
                }
              ]
            }
          ]
        }
      ]
    }
  ]
}
